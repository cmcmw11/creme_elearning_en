<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Creme E-Learning</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Sarabun', sans-serif;
      background-color: #dff3fc;
      display: flex;
      justify-content: center;
    }
    .iphone-frame {
      width: 375px;
      min-height: 100vh;
      background-color: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    header {
      background-color: #f8e1f4;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 18px;
    }
    .menu-toggle {
      cursor: pointer;
      font-size: 20px;
    }
    .top-menu {
      display: none;
      flex-direction: column;
      background-color: #ffeefc;
      padding: 10px;
    }
    .top-menu a {
      padding: 5px 0;
      color: #333;
      text-decoration: none;
    }
    .calendar-block {
      padding: 20px;
      background-color: #f0faff;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .day {
      text-align: center;
      padding: 10px 0;
      background-color: #e2f0ff;
      border-radius: 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .day.today {
      background-color: #d0ffe0;
      font-weight: bold;
    }
    .day.done {
      background-color: #b0f5c0;
    }
    .todo-block {
      padding: 15px;
    }
    .todo-block h3 {
      margin-bottom: 10px;
      font-size: 16px;
      color: #444;
    }
    .todo-item {
      background-color: #e2f0ff;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .todo-item input {
      margin-right: 10px;
    }
    nav {
      position: fixed;
      bottom: 0;
      width: 375px;
      background-color: #f8e1f4;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      border-top: 1px solid #ccc;
    }
    nav button {
      background: none;
      border: none;
      font-size: 14px;
      color: #666;
      cursor: pointer;
    }
    nav button.active {
      color: #008cff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="iphone-frame">
    <header>
      <span>Creme E-Learning</span>
      <span class="menu-toggle" onclick="toggleMenu()">‚ò∞</span>
    </header>
    <div class="top-menu" id="topMenu">
      <a href="#">üë§ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="#" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
    </div>

    <div class="calendar-block">
      <div class="calendar-header">
        <span id="monthYear">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2025</span>
        <button onclick="generateCalendar()">üîÑ</button>
      </div>
      <div class="calendar" id="calendarDays"></div>
    </div>

    <div class="todo-block">
      <h3>To-do List</h3>
      <div class="todo-item"><input type="checkbox" onchange="checkTodoCompletion()"> ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="todo-item"><input type="checkbox" onchange="checkTodoCompletion()"> ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</div>
      <div class="todo-item"><input type="checkbox" onchange="checkTodoCompletion()"> ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏î‡∏¥‡∏°</div>
    </div>
<!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô -->
<div class="date-picker">
  <button class="date-btn" onclick="changeDate(-1)">‚Üê</button>
  <span id="selectedDate"></span>
  <button class="date-btn" onclick="changeDate(1)">‚Üí</button>
</div>


    <nav>
      <button class="active">üè† Home</button>
      <button onclick="location.href='vocab-today.html'">üìñ ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</button>
      <button onclick="location.href='exercise.html'">‚úèÔ∏è ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</button>
      <button onclick="location.href='review.html'">üîÅ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</button>
    </nav>
  </div>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('topMenu');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    }

    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "login.html";
      });
    }

    function generateCalendar() {
      const calendar = document.getElementById('calendarDays');
      calendar.innerHTML = '';
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let i = 0; i < firstDay; i++) {
        calendar.innerHTML += '<div></div>';
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        dayDiv.textContent = d;
        if (d === today.getDate()) {
          dayDiv.classList.add('today');
        }
        dayDiv.id = 'day-' + d;
        calendar.appendChild(dayDiv);
      }
    }

    function checkTodoCompletion() {
      const checkboxes = document.querySelectorAll('.todo-item input');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      if (allChecked) {
        const today = new Date().getDate();
        const dayEl = document.getElementById('day-' + today);
        if (dayEl) {
          dayEl.classList.add('done');
        }
      }
    }

    window.onload = generateCalendar;
  </script>

  <!-- Firebase (‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà layout ‡∏´‡∏•‡∏±‡∏Å) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAumDfnarsn2DoM3s0uGNU2l8sfNpD58a0",
      authDomain: "creme-elearning-en.firebaseapp.com",
      projectId: "creme-elearning-en",
      storageBucket: "creme-elearning-en.appspot.com",
      messagingSenderId: "545141834950",
      appId: "1:545141834950:web:4a6f0e532b9208d5c3c3c7",
      measurementId: "G-69NF6JJPNR"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
<script>
  let selectedDate = new Date();  // ‡∏ï‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

  const tasks = [
    "‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ",
    "‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î",
    "‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏î‡∏¥‡∏°"
  ];

  const db = firebase.firestore();
  let uid = null;

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      uid = user.uid;
      generateCalendar();
      loadTodos();
    } else {
      window.location.href = "login.html";
    }
  });

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° ‚Üê ‡∏´‡∏£‡∏∑‡∏≠ ‚Üí
  function changeDate(direction) {
    selectedDate.setDate(selectedDate.getDate() + direction);  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    loadTodos();  // ‡πÇ‡∏´‡∏•‡∏î To-do list ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
    generateCalendar();  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô
  }

  // ‡πÇ‡∏´‡∏•‡∏î To-do ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  async function loadTodos() {
    const container = document.querySelector(".todo-block");
    const dateKey = formatDate(selectedDate); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    document.getElementById('selectedDate').textContent = formatDate(selectedDate);

    container.innerHTML = '<h3>To-do List</h3>';

    let todayData = {};
    try {
      const doc = await db.collection("todos").doc(uid).get();
      todayData = doc.exists && doc.data()[dateKey] ? doc.data()[dateKey] : {};
    } catch (err) {
      console.error("Error loading Firestore", err);
    }

    tasks.forEach(task => {
      const checked = todayData[task] ? "checked" : "";
      container.innerHTML += `
        <div class="todo-item">
          <input type="checkbox" data-task="${task}" onchange="saveTodo()" ${checked}>
          ${task}
        </div>
      `;
    });
  }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å To-do
  async function saveTodo() {
    const checkboxes = document.querySelectorAll('.todo-item input');
    const dateKey = formatDate(selectedDate);
    let todayData = {};
    checkboxes.forEach(cb => {
      const task = cb.getAttribute("data-task");
      todayData[task] = cb.checked;
    });

    try {
      await db.collection("todos").doc(uid).set({
        [dateKey]: todayData
      }, { merge: true });
    } catch (err) {
      console.error("Error saving to Firestore", err);
    }
  }

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
  function formatDate(date) {
    return date.toISOString().split('T')[0];  // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
  async function generateCalendar() {
    const calendar = document.getElementById('calendarDays');
    calendar.innerHTML = '';
    const year = selectedDate.getFullYear();
    const month = selectedDate.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    let userData = {};
    try {
      const doc = await db.collection("todos").doc(uid).get();
      if (doc.exists) userData = doc.data();
    } catch (err) {
      console.error("Error getting Firestore", err);
    }

    for (let i = 0; i < firstDay; i++) {
      calendar.innerHTML += '<div></div>';
    }

    for (let d = 1; d <= daysInMonth; d++) {
      const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
      const done = userData[dateKey] && Object.values(userData[dateKey]).every(val => val);

      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';
      dayDiv.textContent = d;
      if (d === selectedDate.getDate()) {
        dayDiv.classList.add('today');
      }
      if (done) {
        dayDiv.classList.add('done');
      }
      dayDiv.id = 'day-' + d;
      dayDiv.onclick = function() {
        selectedDate.setDate(d);
        loadTodos();
      };
      calendar.appendChild(dayDiv);
    }
  }

  function logout() {
    firebase.auth().signOut().then(() => {
      window.location.href = "login.html";
    });
  }
</script>

</body>
</html>
